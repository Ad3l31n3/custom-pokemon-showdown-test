{
  "version": 3,
  "sources": ["../../../server/chat-plugins/veteran-badges.ts"],
  "sourcesContent": ["import {Badge} from '../badges';\nimport {Badges} from './badges';\n\ninterface VeteranBadgeConfiguration {\n\tformatId: string;\n\tbadgeId: string;\n\tminimumElo: 1200;\n\tminimumBattles: number;\n\tminimumWinrate: number;\n\tbadge?: Badge;\n}\n\nlet veteranBadgeConfigurations: VeteranBadgeConfiguration[] = [\n\t{\n\t\tformatId: 'gen8cloveronlyou',\n\t\tbadgeId: 'ouveteran',\n\t\tminimumElo: 1200,\n\t\tminimumBattles: 100,\n\t\tminimumWinrate: 0.40,\n\t},\n\t{\n\t\tformatId: 'gen8cloveronlyuu',\n\t\tbadgeId: 'uuveteran',\n\t\tminimumElo: 1200,\n\t\tminimumBattles: 100,\n\t\tminimumWinrate: 0.40,\n\t},\n\t{\n\t\tformatId: 'gen8cloveronlyru',\n\t\tbadgeId: 'ruveteran',\n\t\tminimumElo: 1200,\n\t\tminimumBattles: 100,\n\t\tminimumWinrate: 0.40,\n\t},\n\t{\n\t\tformatId: 'gen8cloveronlynu',\n\t\tbadgeId: 'nuveteran',\n\t\tminimumElo: 1200,\n\t\tminimumBattles: 100,\n\t\tminimumWinrate: 0.40,\n\t},\n\t{\n\t\tformatId: 'gen8cloveronlyubers',\n\t\tbadgeId: 'ubersveteran',\n\t\tminimumElo: 1200,\n\t\tminimumBattles: 100,\n\t\tminimumWinrate: 0.40,\n\t},\n\t{\n\t\tformatId: 'gen8cloveronlylc',\n\t\tbadgeId: 'lcveteran',\n\t\tminimumElo: 1200,\n\t\tminimumBattles: 100,\n\t\tminimumWinrate: 0.40,\n\t},\n\t{\n\t\tformatId: 'gen8clovercaponlyou',\n\t\tbadgeId: 'capveteran',\n\t\tminimumElo: 1200,\n\t\tminimumBattles: 100,\n\t\tminimumWinrate: 0.40,\n\t},\n\t{\n\t\tformatId: 'gen8cloverblobboscaponlyou',\n\t\tbadgeId: 'cabveteran',\n\t\tminimumElo: 1200,\n\t\tminimumBattles: 100,\n\t\tminimumWinrate: 0.40,\n\t},\n\t{\n\t\tformatId: 'gen8wackonlyou',\n\t\tbadgeId: 'wackveteran',\n\t\tminimumElo: 1200,\n\t\tminimumBattles: 100,\n\t\tminimumWinrate: 0.40,\n\t},\n\t{\n\t\tformatId: 'gen8sandboxonlyou',\n\t\tbadgeId: 'sandboxveteran',\n\t\tminimumElo: 1200,\n\t\tminimumBattles: 100,\n\t\tminimumWinrate: 0.40,\n\t},\n];\n\nconst initializeVeteranBadges = async () => {\n\tif (!Config.usesqlitebadges) return;\n\tveteranBadgeConfigurations = await Promise.all(veteranBadgeConfigurations.map(async (veteranBadgeConfiguration) => {\n\t\tif (veteranBadgeConfiguration.badge) return veteranBadgeConfiguration;\n\n\t\ttry {\n\t\t\tconst badge = await Badges.getBadge(veteranBadgeConfiguration.badgeId);\n\t\t\treturn {\n\t\t\t\t...veteranBadgeConfiguration,\n\t\t\t\tbadge,\n\t\t\t};\n\t\t} catch (error) {}\n\n\t\treturn veteranBadgeConfiguration;\n\t}));\n};\n\nexport const loginfilter: Chat.LoginFilter = user => {\n\tvoid initializeVeteranBadges().then(() => {\n\t\tveteranBadgeConfigurations.forEach(({formatId, badgeId, minimumElo, minimumBattles, minimumWinrate, badge}) => {\n\t\t\tif (!badge) return;\n\t\t\tconst ladder = Ladders(toID(formatId));\n\t\t\tvoid ladder.getTopData().then((rows) => {\n\t\t\t\trows.forEach((row) => {\n\t\t\t\t\tconst rowUserId = toID(row[2]);\n\t\t\t\t\tif (rowUserId !== user.id) return;\n\t\t\t\t\tconst totalGames = row[3] + row[4] + row[5];\n\t\t\t\t\tconst winrate = row[3] / totalGames;\n\n\t\t\t\t\tif (totalGames < minimumBattles) return;\n\t\t\t\t\tif (winrate < minimumWinrate) return;\n\t\t\t\t\tif (row[1] < minimumElo) return;\n\t\t\t\t\tvoid Badges.addBadgeToUser(user.id, badgeId, user, true).catch(() => {});\n\t\t\t\t});\n\t\t\t}).catch(() => {});\n\t\t});\n\t}).catch(() => {});\n};\n"],
  "mappings": "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",
  "names": ["import_badges"]
}
